---
name: security-review
description: "セキュリティレビューを実行。Use when: セキュリティ確認、脆弱性チェック、本番デプロイ前"
---

# セキュリティレビュー Skill

## 概要

OWASP Top 10 および IaC セキュリティベストプラクティスに基づくセキュリティレビューを実行します。

## トリガー条件

以下の場合に自動的に適用されます：
- 「セキュリティ」「脆弱性」「security」というキーワードが含まれる場合
- 認証・認可関連のコード変更時
- インフラストラクチャコードの変更時
- 本番デプロイ前のレビュー

## チェック項目

### Python セキュリティ

| カテゴリ | チェック内容 |
|---------|-------------|
| インジェクション | SQL, コマンド, LDAP インジェクション |
| 認証 | パスワード処理, セッション管理 |
| 機密データ | ハードコードされたシークレット |
| XXE | XML 外部エンティティ |
| アクセス制御 | 認可チェックの欠落 |
| 設定ミス | デバッグモード, 詳細エラー |
| XSS | クロスサイトスクリプティング |
| デシリアライゼーション | 安全でないデシリアライゼーション |
| 依存関係 | 脆弱な依存パッケージ |
| ログ | 機密情報のログ出力 |

```bash
# 実行コマンド
bandit -r . -f json
pip-audit
safety check
```

### Terraform セキュリティ

| カテゴリ | チェック内容 |
|---------|-------------|
| IAM | 過剰な権限, ワイルドカード使用 |
| ネットワーク | 0.0.0.0/0 の開放, SSH/RDP 公開 |
| 暗号化 | 保存時・転送時の暗号化 |
| ログ | CloudTrail, VPC Flow Logs |
| バケット | S3 パブリックアクセス |
| データベース | RDS 暗号化, パブリックアクセス |

```bash
# 実行コマンド
tfsec . --format json
checkov -d . --output json
```

## 重大度定義

| レベル | 説明 | 対応 |
|--------|------|------|
| CRITICAL | 即座に悪用可能な脆弱性 | 即時修正必須 |
| HIGH | 重大なセキュリティリスク | デプロイ前に修正 |
| MEDIUM | 中程度のリスク | 計画的に修正 |
| LOW | 軽微なリスク | ベストプラクティス推奨 |
| INFO | 情報提供 | 参考情報 |

## 出力フォーマット

```markdown
## セキュリティレビュー結果

### サマリー
- CRITICAL: X 件
- HIGH: Y 件
- MEDIUM: Z 件
- LOW: W 件

### 検出された脆弱性

#### [CRITICAL] シークレットのハードコード
- **ファイル**: `config.py:42`
- **説明**: AWS アクセスキーがソースコードに含まれています
- **リスク**: 認証情報の漏洩によるアカウント侵害
- **修正案**: 環境変数または AWS Secrets Manager を使用
```python
# Before
AWS_ACCESS_KEY = "AKIA..."

# After
import os
AWS_ACCESS_KEY = os.environ["AWS_ACCESS_KEY_ID"]
```

### 推奨事項
1. [セキュリティ強化の提案]
```

## ルール

- 誤検知（False Positive）の可能性がある場合は明記する
- 修正案は必ず安全な代替コードを提示する
- シークレットの実際の値は出力しない
